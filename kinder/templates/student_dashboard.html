<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% load static %}
    
    <title>Student Dashboard</title>

    <link rel="icon" href="{% static 'images/studenticon.jpg' %}" size="64x64" type="image/png"
    <link rel="stylesheet" href="{% static 'styles/styles.css' %}" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: #f4f7fa;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height: 100vh;
        margin: 0;
      }

      .dashboard-container {
        display: flex;
        width: 100%;
        height: 100vh;
      }

      .sidebar {
        width: 250px;
        background: #2c3e50;
        color: white;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      .sidebar h2 {
        font-size: 1.5rem;
        margin-bottom: 20px;
      }

      .sidebar img {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin-bottom: 15px;
      }

      .sidebar ul {
        list-style: none;
        width: 100%;
        margin-right: 35px;
      }

      .sidebar ul li {
        padding: 10px;
        text-align: center;
        margin: 10px 0;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 5px;
        transition: background 0.3s ease;
        cursor: pointer;
      }

      .sidebar ul li:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      .main-content {
        flex-grow: 1;
        background: #ecf0f1;
        padding: 20px;
        overflow-y: auto;
      }

      .top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 10px 20px;
        background: #3498db;
        color: white;
        border-radius: 5px;
      }

      .top-bar h2 {
        font-size: 1.8rem;
      }

      .card-container {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        margin-top: 20px;
      }

      .card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        width: calc(33.333% - 20px);
        text-align: center;
      }

      .card h3 {
        margin-bottom: 10px;
        font-size: 1.2rem;
        color: black;
      }

      .card p {
        font-size: 1rem;
        color: black;
      }

      .carousel {
        margin-top: 20px;
        border-radius: 10px;
        overflow: hidden;
      }

      .carousel img {
        width: 100%;
        height: 300px;
        object-fit: cover;
      }

      .chart-container {
        margin-top: 20px;
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        width: 100%;
        margin-left: auto;
        margin-right: auto;
      }

      .profile-form {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        max-width: 400px;
        margin: 20px auto;
      }

      .profile-form label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
      }

      .profile-form input,
      .profile-form textarea {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }

      .profile-form button {
        background: #3498db;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }

      .profile-form button:hover {
        background: #2980b9;
      }

      /* Homework Section Styling */
.homework-section, .assignments-section {
    margin-bottom: 30px;
}
#homework h2, .assignments-section h2{
  background-color: black;
  padding-left: 20px;
  color: white;
  border-radius: 10px;
  font-size: 25px;
}

.homework-section h3, .assignments-section h3 {
    font-size: 1.5rem;
    color: #2c3e50;
    margin-bottom: 15px;
    border-bottom: 2px solid #3498db;
    padding-bottom: 5px;
}

.homework-container, .assignments-container {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-top: 10px;
}

.homework-card, .assignment-card {
    background: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    width: calc(33.333% - 20px);
    text-align: left;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}
.assignment-card {
  width: 100%;
}
.homework-card:hover, .assignment-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.homework-card h4, .assignment-card h4 {
    margin-bottom: 10px;
    font-size: 1.2rem;
    color: #2c3e50;
}

.homework-card p, .assignment-card p {
    font-size: 1rem;
    color: #555;
    margin-bottom: 5px;
}

.assigned {
    font-weight: bold;
    color: #3498db;
    margin-top: 10px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .homework-card, .assignment-card {
        width: 100%;
    }
}

      .events-container {
        margin-top: 20px;
        position: relative;
        height: 400px;
        overflow: hidden;
      }

      .events-scroll {
        position: absolute;
        top: 0;
        width: 100%;
        animation: scrollEvents 10s linear infinite;
      }

      .events-scroll:hover {
        animation-play-state: paused;
      }

      @keyframes scrollEvents {
        0% {
          top: 100%;
        }
        100% {
          top: -100%;
        }
      }

      .event-card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        background: #2c3e50;
      }

      .event-card h3 {
        margin-bottom: 10px;
        font-size: 1.2rem;
        font-weight: bolder;
        color: white;
      }

      .event-card p {
        font-size: 1rem;
        color: white;
      }
      #sidebar-bio {
        text-align: center;
      }

      /* Adding background images and animations */
      .section {
        position: relative;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        animation: fadeIn 1s ease-in-out;
      }

      #home {
        background-image: url('{% static "images/homeback.jpg" %}');
        background-size: cover;
        background-position: center;
        animation: slideIn 1s ease-out;
      }

      #profile {
        background-image: url('{% static "images/profileback.jpg" %}');
        background-size: cover;
        background-position: center;
        animation: fadeIn 2s ease-in-out;
      }

      #homework {
        background-image: url('{% static "images/homeworkback.jpg" %}');
        background-size: cover;
        background-position: center;
        animation: slideIn 1s ease-out;
      }

      #grades {
        background-image: url('{% static "images/grades-background.jpg" %}');
        background-size: cover;
        background-position: center;
        animation: fadeIn 2s ease-in-out;
      }

      #events {
        background-image: url('{% static "images/homeback.jpeg" %}');
        background-size: cover;
        background-position: center;
        animation: slideIn 1s ease-out;
      }
      #events::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: inherit; /* Inherit the background image */
        background-size: cover;
        background-position: center;
        filter: blur(10px); /* Apply the blur effect */
        z-index: -1; /* Ensure the blurred background is behind the content */
      }

#activities {
    background: rgba(255, 255, 255, 0.95);
    padding: 25px;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    margin-top: 20px;
}

.activity-card {
    background: #ffffff;
    border: 1px solid #e0e0e0;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 20px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.activity-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
}

.activity-card h4 {
    font-size: 1.25rem;
    color: #2c3e50;
    margin-bottom: 10px;
}

.activity-card p {
    font-size: 0.95rem;
    color: #555;
    line-height: 1.6;
}

.status-badge {
    display: inline-block;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.85rem;
    font-weight: 500;
    margin-top: 10px;
}

.status-badge.pending {
    background: #ffeb3b;
    color: #000;
}

.status-badge.approved {
    background: #4caf50;
    color: #fff;
}

.status-badge.rejected {
    background: #f44336;
    color: #fff;
}

.admin-comment {
    background: #f9f9f9;
    border-left: 4px solid #3498db;
    padding: 12px;
    margin-top: 15px;
    border-radius: 6px;
}

.admin-comment strong {
    color: #3498db;
    font-weight: 600;
}

.notification-badge {
    position: absolute;
    top: -10px;
    right: -10px;
    background: #e74c3c;
    color: white;
    font-size: 0.75rem;
    padding: 4px 8px;
    border-radius: 50%;
    animation: pulse 1.5s infinite;
}
.form-group{
  padding: 15px;
}
.form-group input{
  padding: 0 10px;
}
.activity-item{
  padding: 10px;
}
.activity-time{
  color:rgb(185, 181, 181);
}
.status-badge {
  display: inline-block;
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.85rem;
  font-weight: 500;
}

.status-badge.present {
  background: #4caf50;
  color: white;
}

.status-badge.absent {
  background: #f44336;
  color: white;
}
.attendance-summary {
    margin-bottom: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.attendance-summary h3 {
    margin: 0;
    font-size: 1.2rem;
    color: #2c3e50;
}
{% comment %} .assigned{
  font-weight: bold;
} {% endcomment %}


@media (max-width: 768px) {
    .assignment-card {
        width: 100%;
    }
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.1);
    }
    100% {
        transform: scale(1);
    }
}
      /* Keyframes for fade-in animation */
      @keyframes fadeIn {
        0% {
          opacity: 0;
        }
        100% {
          opacity: 1;
        }
      }

      /* Keyframes for slide-in animation */
      @keyframes slideIn {
        0% {
          transform: translateX(100%);
          opacity: 0;
        }
        100% {
          transform: translateX(0);
          opacity: 1;
        }
      }

      @media (max-width: 768px) {
        .dashboard-container {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          text-align: center;
        }
        .card,
        .homework-card {
          width: 100%;
        }
        .chart-container {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="dashboard-container">
      <aside class="sidebar">
        {% if student.profile_picture %}
        <img
          id="profile-picture"
          src="{{ student.profile_picture.url }}"
          alt="Profile"
        />
        {% else %}
        <img
          id="profile-picture"
          src="{% static 'images/default_profile.png' %}"
          alt="Default Profile"
        />
        {% endif %}
        <h2>{{ student.name }}</h2>
        <ul>
          <li onclick="showSection('home')">🏠 Home</li>
          <li onclick="showSection('profile')">👨🏼‍🦱 Profile</li>
          <li onclick="showSection('homework')">📕 Homework</li>
          <li onclick="showSection('grades')">📑 Grades</li>
          <li onclick="showSection('events')">🥳 Events</li>
          <li onclick="showSection('activities')">📚 Activities</li>
          <li onclick="showSection('attendance')">📅 Attendance</li>  
          <li>
              <a href="{% url 'logout' %}" style="color: white; text-decoration: none">Logout</a>
          </li>
        </ul>
      </aside>

      <main class="main-content">
        <div class="top-bar">
          <h2>Student Dashboard - Welcome, {{ student.name }}!</h2>
        </div>

        <!-- Home Section -->
        <div id="home" class="section">
          <div
            id="carouselExample"
            class="carousel slide"
            data-bs-ride="carousel"
          >
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="{% static 'images/scl3.jpg' %}" alt="Slide 1" />
              </div>
              <div class="carousel-item">
                <img src="{% static 'images/scl6.jpg' %}" alt="Slide 2" />
              </div>
              <div class="carousel-item">
                <img src="{% static 'images/scl5.webp' %}" alt="Slide 3" />
              </div>
            </div>
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#carouselExample"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#carouselExample"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>


          <h2>Important Dates</h2>
          <div class="events-container">
            <div class="events-scroll">
              {% for event in events %}
              <div class="event-card">
                <h3>{{ event.title }}</h3>
                <p>Date: {{ event.event_date }}</p>
                <p>{{ event.details }}</p>
              </div>
              {% empty %}
              <p>No events available.</p>
              {% endfor %}
            </div>
          </div>

          <div class="chart-container">
            <canvas id="performanceChart"></canvas>
          </div>
        </div>

        <!-- Profile Section -->
        <div id="profile" class="section" style="display: none">
          <h2>Profile</h2>
          <div class="profile-form">
            <form
              method="post"
              action="{% url 'update_profile' student.student_id %}"
              enctype="multipart/form-data"
            >
              {% csrf_token %}
              <label for="name">Name:</label>
              <input
                type="text"
                id="name"
                name="name"
                value="{{ student.name }}"
              />
              <label for="bio">Bio:</label>
              <textarea id="bio" name="bio">{{ student.bio }}</textarea>
              <label for="profile_picture">Profile Picture:</label>
              <input type="file" id="profile_picture" name="profile_picture" />
              <button type="submit">Save Changes</button>
            </form>
          </div>
        </div>


        <!-- Homework Section -->
<div id="homework" class="section" style="display: none">
  <h2>Homework</h2>

  <!-- General Homework -->
  <div class="homework-section">
      <div class="homework-container">
          {% for homework in homeworks %}
          <div class="homework-card">
              <h4>{{ homework.title }}</h4>
              <p>Due: {{ homework.due_date }}</p>
              <p>{{ homework.details }}</p>
          </div>
          {% empty %}
          <p>No homework available.</p>
          {% endfor %}
      </div>
  </div>

  <!-- Assignments -->
  <div class="assignments-section">
      <h2>Assignments from Teachers</h2>
      <div class="assignments-container">
          {% for assignment in assignments %}
          <div class="assignment-card">
              <h4>{{ assignment.title }}</h4>
              <p>Due: {{ assignment.due_date }}</p>
              <p>{{ assignment.details }}</p>
              <p class="assigned">Assigned by: {{ assignment.assigned_by.name }}</p>
          </div>
          {% empty %}
          <p>No assignments available.</p>
          {% endfor %}
      </div>
  </div>
</div>

        <div id="activities" class="section" style="display: none;">
          <h2>My Activities</h2>
          
          <!-- Activity Submission Form -->
          <div class="activity-card">
              <h3>Submit New Activity</h3>
              <form method="post" action="{% url 'submit_activity' student.student_id %}" enctype="multipart/form-data">
                  {% csrf_token %}
                  <div class="form-group">
                      <label for="title">Title</label>
                      <input type="text" name="title" class="form-control" required>
                  </div>
                  <div class="form-group">
                      <label for="description">Description</label>
                      <textarea name="description" class="form-control" rows="3" required></textarea>
                  </div>
                  <div class="form-group">
                      <label for="file">Upload Attachment (PDF, DOC, JPEG, PNG)</label>
                      <input type="file" name="file" class="form-control" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png">
                  </div>
                  <button type="submit" class="btn btn-primary">Submit</button>
              </form>
          </div>
      
          <!-- Activity History -->
          <div class="activity-card">
              <h3>Activity History</h3>
              {% for activity in activities %}
              <div class="activity-item">
                  <div class="activity-header d-flex justify-content-lg-between">
                      <h4 class="activity-title">{{ activity.title }}</h4>
                      <span class="activity-time">{{ activity.created_at|date:"d M Y, H:i" }}</span> <!---Displays the current time-->
                  </div>
                  <p>{{ activity.description }}</p>
                  <!-- Display Attachment if Exists -->
                  {% if activity.file %}
                  <div class="attachment">
                      <strong>Attachment:</strong>
                      <a href="{{ activity.file.url }}" target="_blank" class="btn btn-sm btn-outline-primary">
                          View File
                      </a>
                  </div>
                  {% endif %}
                  
                  <div class="status-badge {{ activity.status }}">
                      {{ activity.get_status_display }}
                  </div>
                  
                  {% if activity.admin_comment %}
                  <div class="admin-comment">
                      <strong>Admin Feedback:</strong> {{ activity.admin_comment }}
                      {% if activity.status == 'approved' or activity.status == 'rejected' %}
                      <span class="notification-badge">New</span>
                      {% if activity.admin_comment %}
                      <div class="reply-time d-flex justify-content-lg-end">
                          Reply Time:
                          <span class="activity-time">{{ activity.updated_at|date:"d M Y, H:i" }}</span>
                      </div>
                  {% endif %}
                      {% endif %}
                  </div>
                  {% endif %}
              </div>
              {% empty %}
              <p>No activities submitted yet.</p>
              {% endfor %}
          </div>
      </div>

<!-- student_dashboard.html -->
<div id="attendance" class="section" style="display: none;">
  <h2>Attendance</h2>
  <div class="attendance-summary">
      <h3>Overall Attendance Percentage: {{ attendance_percentage }}%</h3>
  </div>
  <table class="attendance-table">
      <thead>
          <tr>
              <th>Date</th>
              <th>Status</th>
          </tr>
      </thead>
      <tbody>
          {% for record in attendance_records %}
          <tr>
              <td>{{ record.date }}</td>
              <td>
                  <span class="status-badge {% if record.status == 'present' %}present{% else %}absent{% endif %}">
                      {{ record.status|title }}
                  </span>
              </td>
          </tr>
          {% empty %}
          <tr>
              <td colspan="2">No attendance records found.</td>
          </tr>
          {% endfor %}
      </tbody>
  </table>
</div>


        <!-- Grades Section -->
        <div id="grades" class="section" style="display: none">
          <h2>Grades</h2>
          <div class="chart-container">
            <canvas id="gradesChart"></canvas>
          </div>
        </div>

        <!-- Events Section -->
        <div id="events" class="section" style="display: none">
          <h2>Important Dates</h2>
          <div class="events-container">
            <div class="events-scroll">
              {% for event in events %}
              <div class="event-card">
                <h3>{{ event.title }}</h3>
                <p>Date: {{ event.event_date }}</p>
                <p>{{ event.details }}</p>
              </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>

      // function for performance chart
      const performanceCtx = document
        .getElementById("performanceChart")
        .getContext("2d");
      const performanceChart = new Chart(performanceCtx, {
        type: "line",
        data: {
          labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          datasets: [
            {
              label: "Performance",
              data: [85, 90, 88, 92, 95, 93],
              borderColor: "#3498db",
              fill: false,
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });

      // for grades chart section
      const gradesCtx = document.getElementById("gradesChart").getContext("2d");
      const gradesChart = new Chart(gradesCtx, {
        type: "bar",
        data: {
          labels: ["Math", "Science", "History", "English"],
          datasets: [
            {
              label: "Grades",
              data: [90, 85, 88, 92],
              backgroundColor: ["#3498db", "#2ecc71", "#e74c3c", "#9b59b6"],
            },
          ],
        },
        options: {
          responsive: true,
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });

      // Update profile picture and bio in the sidebar
      document
        .getElementById("profile_picture")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("profile-picture").src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      // Update bio preview
      document
        .getElementById("bio")
        .addEventListener("input", function (event) {
          document.getElementById("sidebar-bio").textContent =
            event.target.value;
        });

      const eventsScroll = document.querySelector(".events-scroll");

      if (eventsScroll) {
        eventsScroll.addEventListener("mouseenter", () => {
          eventsScroll.style.animationPlayState = "paused";
        });

        eventsScroll.addEventListener("mouseleave", () => {
          eventsScroll.style.animationPlayState = "running";
        });
      }


      function showSection(sectionId) {
        document.querySelectorAll(".section").forEach((section) => {
            section.style.display = "none";
        });
        document.getElementById(sectionId).style.display = "block";
    
        if(sectionId === 'activities') {
            document.getElementById(sectionId).scrollIntoView({behavior: 'smooth'});
        }
    }

    function checkNewMessages() {
      const adminComments = document.querySelectorAll('.admin-comment');
      adminComments.forEach(comment => {
          const notificationBadge = comment.querySelector('.notification-badge');
          if (comment.textContent.includes('Admin Feedback')) {
              notificationBadge.style.display = 'block';
          } else {
              notificationBadge.style.display = 'none';
          }
      });
  }

  document.addEventListener('DOMContentLoaded', checkNewMessages);

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
